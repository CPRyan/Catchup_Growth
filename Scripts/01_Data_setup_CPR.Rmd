---
title: "01_Data_Setup"
author: "Calen P. Ryan"
date: "6/30/2021"
output: html_document
---

We have data in dozens of files across decades of time. We need the data in the format we can work with. I'll start bringing things together. A key aspect to this analysis is that it has to be **scaleable**, in that we will later expand the sample size and need to make it as easy as possible to do so without massive changes to the code. 



# Load packages
```{r}
library(tidyverse) # great collection of packages for data carpentry, modelling, and visualization
library(haven) # package for loading Stata's .dta files. 
library(sjlabelled) # good for renaming, changing classes, etc. in the piped dplyr mode

here::here()
# sets a placeholder 'here'. Then we refer to our files based on the *relative* not the *absolute* location.
```



# Load maternal/child data, birthdays, and early growth parameters

# Load and inspect 83-86
```{r}

mbirth2 <-read_dta(here::here("Data/zip_mother_1983_86/mbirth2.dta")) %>% # note: here::here calls the here function
  rename_all(tolower)

dim(mbirth2)
```

```{r}
names(mbirth2)
```
Lots of names that are not easy to interpret. We must read the document
```{r}
file.show(here::here("Data/zip_mother_1983_86/mbirth.txt")) # or you can click on it - easier to 'control + f ' to find words

```

Find the variables that relate to growth in this dataset
```{r}
print("nothing in here yet - place holder")
```


Find the variables in the 91 dataset that pertain to age

All of the community data was collected on the same day - I'm going to check all three files and make sure they all look similar. 
```{r}

```

```{r}
meaghan_full <-read_dta(here::here("Data/Misc/Full_cohort_for_Meaghan.dta")) %>% # note: here::here calls the here function
  rename_all(tolower)

names(meaghan_full)[1:1000]

sample_dates <-meaghan_full %>% 
  select(basebrgy, basewman, uncchdid, contains("intrvw91"), contains("icage91"))
```

```{r}
source(here::here("Scripts/Functions.R"))

library(tidyverse)

create_date(df = sample_dates, 
            year = yrintrvw91, 
            month = mointrvw91, 
            day = dyintrvw91)

sample_dates$meg_dates <-lubridate::make_date(year = sample_dates$yrintrvw91, 
            month = sample_dates$mointrvw91, 
            day = sample_dates$dyintrvw91)
```

```{r}
iq_dates <-read_dta(here::here("Data/zip_child_91/iq91.dta")) %>% # note: here::here calls the here function
  rename_all(tolower) %>% 
  select(basebrgy, basewman, yeariq, monthiq, dayiq) %>% 
  mutate(iq_date = lubridate::make_date( yeariq+1900, monthiq, dayiq))



```

```{r}
left_join(sample_dates, iq_dates, by = c("basebrgy", "basewman")) %>% 
  mutate(iq_intrvw_date_diff = iq_date - meg_dates) %>% 
  select(basebrgy, basewman, uncchdid, iq_intrvw_date_diff) 
```

```{r}
growth83_86_data %>% 
  mutate(ic_mom_info = paste(basebrgy, basewman, sep = "_")) %>% 
  mutate(age_weigh_month = time_length(days(age_at_weigh_days), unit = "months")) %>% 
  select(ic_mom_info, sexchild, age_weigh_month, weightak_kg, heightcm) %>% 
  top_n(200) %>% 
  rename(id = ic_mom_info, 
         sex = sexchild, 
         agemons = age_weigh_month,
         weight = weightak_kg, 
         height = heightcm) %>% 
  write_csv(here::here("Output/Data/CPR/sample_for_WHOcurves.csv"))
  
  
```

