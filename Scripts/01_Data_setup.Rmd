---
title: "01_Data_Setup"
author: "Calen P. Ryan"
date: "6/30/2021"
output: html_document
---

We have data in dozens of files across decades of time. We need the data in the format we can work with. I'll start bringing things together. A key aspect to this analysis is that it has to be **scaleable**, in that we will later expand the sample size and need to make it as easy as possible to do so without massive changes to the code. 



# Load packages
```{r}
library(tidyverse) # great collection of packages for data carpentry, modelling, and visualization
library(haven) # package for loading Stata's .dta files. 
library(sjlabelled) # good for renaming, changing classes, etc. in the piped dplyr mode
library(zscorer)
library(lubridate)
library(anthro)
here::here()
# sets a placeholder 'here'. Then we refer to our files based on the *relative* not the *absolute* location.
```



# Load maternal/child data, birthdays, and early growth parameters

# Load and inspect 83-86
```{r}

mbirth2 <-read_dta(here::here("Data/zip_mother_1983_86/mbirth2.dta")) %>% # note: here::here calls the here function
  rename_all(tolower)

dim(mbirth2)
```
```{r}
names(mbirth2)
```
Lots of names that are not easy to interpret. We must read the document
```{r}
file.show(here::here("Data/zip_mother_1983_86/mbirth.txt")) # or you can click on it - easier to 'control + f ' to find words

```

Find the variables that relate to growth in this dataset
```{r}

growth83_86_data<-mbirth2 %>% 
  select(basebrgy,hhldnubi, basewman, sexchild, outcome, daybirth, mnthbrth, yearbirt, dayintw, mothintw, yearintw, bbweight,weight1, weightak, weightgm, heightcm ) %>% 
  mutate(weightak_kg = (weightak/1000)) %>% 
  mutate(birthdate = make_date(yearbirt, mnthbrth, daybirth)) %>% 
  mutate(intwdate = make_date(yearintw, mothintw, dayintw)) %>% 
  mutate(age_at_weigh_days = as.numeric(intwdate - birthdate)) %>%
  filter(outcome != "2" | outcome !="3" ) %>% 
  filter(age_at_weigh_days < 30) %>% 
  filter(age_at_weigh_days > 0)


zscores83_86 <- with(growth83_86_data, anthro_zscores(
  sex = sexchild, age = age_at_weigh_days, weight = weightak_kg, lenhei = heightcm))
    
growth83_86_data
zscores83_86


```

```{r}
ggplot(growth83_86_data, aes(x = weight1))+
  geom_histogram(color = "white")

ggplot(growth83_86_data, aes(x = weightak))+
  geom_histogram(color = "white")

ggplot(growth83_86_data, aes(x = weightgm))+
  geom_histogram(color = "white")
  
ggplot(growth83_86_data, aes(x=heightcm))+
  geom_histogram(color = "white")
```
```{r}

ggplot(growth83_86_data, aes(x=wfaz))+
  geom_histogram(color = "white")+
  facet_wrap(~sexchild)


ggplot(growth83_86_data, aes(x=hfaz))+
  geom_histogram(color = "white")+
  facet_wrap(~sexchild)
  
summary_wfaz83_86 <- growth83_86_data %>%
  group_by(sexchild) %>% 
  drop_na() %>%
  summarize(mean_wfaz83_86 = mean(wfaz),
            std_dev_wfaz83_86 = sd(wfaz),
            med_wfaz83_86 = median(wfaz),
            count = n(), .groups = "keep")

summary_hfaz83_86 <- growth83_86_data %>%
  group_by(sexchild) %>% 
  drop_na() %>%
  summarize(mean_hfaz83_86 = mean(hfaz),
            std_dev_hfaz83_86 = sd(hfaz),
            med_hfaz83_86 = median(hfaz),
            count = n(), .groups = "keep")

summary_wfaz83_86
summary_hfaz83_86 
```


#Load and inspect 91 data
```{r}
child2 <-read_dta(here::here("Data/zip_child_91/child291.dta")) %>% # note: here::here calls the here function
  rename_all(tolower)

hhold91 <-read_dta(here::here("Data/zip_household_91/hhold91.dta")) %>% # note: here::here calls the here function
  rename_all(tolower)

dim(child2)
dim(hhold91)
```

```{r}
growth2 <-child2 %>%
  select(basebrgy, basewman, basehhno, currbrgy, weghtndx, hightndx) 

intw_date91 <- hhold91 %>% 
  select(basebrgy, basewman, mointr91, dyintrvw, yrintr91)

birthdates_data <- growth83_86_data %>% 
  select(basebrgy, basewman, sexchild, birthdate)

growth91_data <- left_join(growth2, intw_date91, by = c("basebrgy", "basewman"))
         
growth91_data <- left_join(growth91_data, birthdates_data, by = c("basebrgy", "basewman"))

growth91_data
```

```{r}
growth91_data<- growth91_data %>% 
  mutate(intwdate2 = make_date( yrintr91, mointr91, dyintrvw)) %>% 
  mutate(age2_days = as.numeric(intwdate2 - birthdate))

growth91_data <- addWGSR(data = growth91_data, sex = "sexchild", firstPart= "weghtndx", secondPart = "age2_days", index = "wfa")

growth91_data <- addWGSR(data = growth91_data, sex = "sexchild", firstPart = "hightndx", secondPart = "age2_days", index = "hfa")

growth91_data
```
```{r}
ggplot(growth91_data, aes(x=wfaz))+
  geom_histogram(color = "white")+
  facet_wrap(~sexchild)

ggplot(growth91_data, aes(x=hfaz))+
  geom_histogram(color = "white")+
  facet_wrap(~sexchild)

summary_wfaz91 <- growth91_data %>%
  group_by(sexchild) %>% 
  drop_na() %>%
  summarize(mean_wfaz91 = mean(wfaz),
            std_dev_wfaz91 = sd(wfaz),
            med_wfaz91 = median(wfaz),
            count = n(), .groups = "keep")

summary_hfaz91 <- growth91_data %>%
  group_by(sexchild) %>% 
  drop_na() %>% 
  summarize(mean_hfaz91 = mean(hfaz),
            std_dev_hfaz91 = sd(hfaz),
            med_hfaz91 = median(hfaz),
            count = n(), .groups = "keep")

summary_hfaz91
summary_wfaz91
```

#Load and inspect 94 data


```{r}

cdietiq <-read_dta(here::here("Data/zip_child_94 2/cdietiq.dta")) %>% # note: here::here calls the here function
  rename_all(tolower)

dim(cdietiq)
names(cdietiq)
```


```{r}
growth94_data <- cdietiq %>% 
  select(basebrgy, basehhn2,basewman,chldwma2,chldcode, mointrv2, dyintrv2, yrintrv2, weghtnd2, hightnd2) %>% 
  filter(chldcode == "1")

growth94_data <- left_join(growth94_data, birthdates_data, by = c("basebrgy", "basewman")) 

growth94_data <- growth94_data %>% 
  mutate(intwdate3 = make_date(yrintrv2, mointrv2, dyintrv2)) %>% 
  mutate(age3_days = as.numeric(intwdate3 - birthdate))

growth94_data <- addWGSR(data = growth94_data, sex = "sexchild", firstPart= "weghtnd2", secondPart = "age3_days", index = "wfa")

growth94_data <- addWGSR(data = growth94_data, sex = "sexchild", firstPart = "hightnd2", secondPart = "age3_days", index = "hfa")

growth94_data

  
```








